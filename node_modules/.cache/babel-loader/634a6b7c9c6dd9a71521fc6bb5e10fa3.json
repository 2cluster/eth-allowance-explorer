{"ast":null,"code":"import _regeneratorRuntime from\"/Users/rudy/Code/HLF2_DEV/network/eth-allowance-explorer/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _slicedToArray from\"/Users/rudy/Code/HLF2_DEV/network/eth-allowance-explorer/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _asyncToGenerator from\"/Users/rudy/Code/HLF2_DEV/network/eth-allowance-explorer/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/rudy/Code/HLF2_DEV/network/eth-allowance-explorer/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/rudy/Code/HLF2_DEV/network/eth-allowance-explorer/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/rudy/Code/HLF2_DEV/network/eth-allowance-explorer/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/rudy/Code/HLF2_DEV/network/eth-allowance-explorer/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from\"react\";// We'll use ethers to interact with the Ethereum network and our contract\nimport{ethers}from\"ethers\";// We import the contract's artifacts and address here, as we are going to be\n// using them with ethers\nimport ABI from\"../contract/abi.json\";import ADR from\"../contract/adr.json\";import ACC from\"../contract/acc.json\";// All the logic of this dapp is contained in the Dapp component.\n// These other components are just presentational ones: they don't have any\n// logic. They just render HTML.\nimport{NoWalletDetected}from\"./NoWalletDetected\";import{ConnectWallet}from\"./ConnectWallet\";import{Loading}from\"./Loading\";import{Transfer}from\"./Transfer\";import{TransferFrom}from\"./TransferFrom\";import{Allowance}from\"./Allowance\";import{TransactionErrorMessage}from\"./TransactionErrorMessage\";import{WaitingForTransactionMessage}from\"./WaitingForTransactionMessage\";import{NoTokensMessage}from\"./NoTokensMessage\";import{Contract}from\"./Contract\";var ERROR_CODE_TX_REJECTED_BY_USER=4001;export var Dapp=/*#__PURE__*/function(_React$Component){_inherits(Dapp,_React$Component);var _super=_createSuper(Dapp);function Dapp(props){var _this;_classCallCheck(this,Dapp);_this=_super.call(this,props);_this.initialState={tokenData:undefined,total:undefined,selectedAddress:undefined,selectedName:undefined,balance:undefined,allowance:undefined,txBeingSent:undefined,transactionError:undefined,networkError:undefined,accountError:undefined};_this.state=_this.initialState;return _this;}_createClass(Dapp,[{key:\"render\",value:function render(){var _this2=this;if(window.ethereum===undefined){return/*#__PURE__*/React.createElement(NoWalletDetected,null);}if(this.state.networkError){return/*#__PURE__*/React.createElement(ConnectWallet,{connectWallet:function connectWallet(){return _this2._connectWallet();},networkError:this.state.networkError,dismiss:function dismiss(){return _this2._dismissNetworkError();}});}if(this.state.accountError||this.state.accounts===undefined||this.state.selectedAddress!==this.state.accounts.controller.toLowerCase()&&this.state.selectedAddress!==this.state.accounts.lender.toLowerCase()&&this.state.selectedAddress!==this.state.accounts.borrower.toLowerCase()){return/*#__PURE__*/React.createElement(ConnectWallet,{connectWallet:function connectWallet(){return _this2._connectWallet();},networkError:this.state.accountError,dismiss:function dismiss(){return _this2._dismissAccountError();}});}if(!this.state.tokenData||!this.state.accounts){return/*#__PURE__*/React.createElement(Loading,null);}console.log(this.state);if(this.state.selectedName===\"controller\"){return/*#__PURE__*/React.createElement(\"div\",{className:\"\"},/*#__PURE__*/React.createElement(\"div\",{className:\"row\"},/*#__PURE__*/React.createElement(Contract,{tokenData:this.state.tokenData})),/*#__PURE__*/React.createElement(\"div\",{className:\"container\"},/*#__PURE__*/React.createElement(\"h2\",null,\"Controller's Account\"),/*#__PURE__*/React.createElement(\"div\",{className:\"row\"},/*#__PURE__*/React.createElement(\"div\",{className:\"col-6 p-3 card\"},/*#__PURE__*/React.createElement(\"h2\",null,\"Lender\"),/*#__PURE__*/React.createElement(\"p\",null,\"Balance:  \",/*#__PURE__*/React.createElement(\"b\",null,\"$ \",(Math.round(this.state.p1balance*Math.pow(this.state.tokenData.decimals,10))/Math.pow(this.state.tokenData.decimals,10)).toFixed(this.state.tokenData.decimals).toString())),/*#__PURE__*/React.createElement(\"p\",null,\"Allowed:  \",/*#__PURE__*/React.createElement(\"b\",null,\"$ \",(Math.round(this.state.p1allowance*Math.pow(this.state.tokenData.decimals,10))/Math.pow(this.state.tokenData.decimals,10)).toFixed(this.state.tokenData.decimals).toString()))),/*#__PURE__*/React.createElement(\"div\",{className:\"col-6 p-3 card\"},/*#__PURE__*/React.createElement(\"h2\",null,\"Borrower\"),/*#__PURE__*/React.createElement(\"p\",null,\"Balance:  \",/*#__PURE__*/React.createElement(\"b\",null,\"$ \",(Math.round(this.state.p2balance*Math.pow(this.state.tokenData.decimals,10))/Math.pow(this.state.tokenData.decimals,10)).toFixed(this.state.tokenData.decimals).toString())),/*#__PURE__*/React.createElement(\"p\",null,\"Allowed:  \",/*#__PURE__*/React.createElement(\"b\",null,\"$ \",(Math.round(this.state.p2allowance*Math.pow(this.state.tokenData.decimals,10))/Math.pow(this.state.tokenData.decimals,10)).toFixed(this.state.tokenData.decimals).toString())))),/*#__PURE__*/React.createElement(\"div\",null,this.state.txBeingSent&&/*#__PURE__*/React.createElement(WaitingForTransactionMessage,{txHash:this.state.txBeingSent}),this.state.transactionError&&/*#__PURE__*/React.createElement(TransactionErrorMessage,{message:this._getRpcErrorMessage(this.state.transactionError),dismiss:function dismiss(){return _this2._dismissTransactionError();}})),/*#__PURE__*/React.createElement(\"div\",{className:\"row mt-10\"},/*#__PURE__*/React.createElement(\"div\",{className:\"col-6 card\"},this.state.balance.eq(0)&&/*#__PURE__*/React.createElement(NoTokensMessage,{selectedAddress:this.state.selectedAddress}),this.state.balance.gt(0)&&/*#__PURE__*/React.createElement(Transfer,{transferTokens:function transferTokens(to,amount){return _this2._transferTokens(to,amount);},tokenSymbol:this.state.tokenData.symbol,accounts:this.state.accounts})),/*#__PURE__*/React.createElement(\"div\",{className:\"col-6 card\"},this.state.balance.eq(0)&&/*#__PURE__*/React.createElement(NoTokensMessage,{selectedAddress:this.state.selectedAddress}),this.state.balance.gt(0)&&/*#__PURE__*/React.createElement(TransferFrom,{transferFromTokens:function transferFromTokens(from,to,amount){return _this2._transferFromTokens(from,to,amount);},tokenSymbol:this.state.tokenData.symbol,accounts:this.state.accounts})))));}else if(this.state.selectedName===\"lender\"||this.state.selectedName===\"borrower\"){return/*#__PURE__*/React.createElement(\"div\",{className:\"\"},/*#__PURE__*/React.createElement(\"div\",{className:\"row\"},/*#__PURE__*/React.createElement(Contract,{tokenData:this.state.tokenData})),/*#__PURE__*/React.createElement(\"div\",{className:\"container\"},/*#__PURE__*/React.createElement(\"div\",{className:\"row\"},/*#__PURE__*/React.createElement(\"h1\",null,this.state.selectedName)),/*#__PURE__*/React.createElement(\"div\",{className:\"row card\"},/*#__PURE__*/React.createElement(\"div\",{className:\"col-3\"},/*#__PURE__*/React.createElement(\"p\",null,\"Balance:\"),/*#__PURE__*/React.createElement(\"p\",null,\"Approved amount:\")),/*#__PURE__*/React.createElement(\"div\",{className:\"col-3\"},/*#__PURE__*/React.createElement(\"p\",null,/*#__PURE__*/React.createElement(\"b\",null,\"$ \",(Math.round(this.state.balance*Math.pow(this.state.tokenData.decimals,10))/Math.pow(this.state.tokenData.decimals,10)).toFixed(this.state.tokenData.decimals).toString())),/*#__PURE__*/React.createElement(\"p\",null,/*#__PURE__*/React.createElement(\"b\",null,\"$ \",(Math.round(this.state.allowance*Math.pow(this.state.tokenData.decimals,10))/Math.pow(this.state.tokenData.decimals,10)).toFixed(this.state.tokenData.decimals).toString())))),/*#__PURE__*/React.createElement(\"div\",null,this.state.txBeingSent&&/*#__PURE__*/React.createElement(WaitingForTransactionMessage,{txHash:this.state.txBeingSent}),this.state.transactionError&&/*#__PURE__*/React.createElement(TransactionErrorMessage,{message:this._getRpcErrorMessage(this.state.transactionError),dismiss:function dismiss(){return _this2._dismissTransactionError();}})),/*#__PURE__*/React.createElement(\"div\",{className:\"row card\"},/*#__PURE__*/React.createElement(\"div\",{className:\"col-4\"},this.state.balance.eq(0)&&/*#__PURE__*/React.createElement(NoTokensMessage,{selectedAddress:this.state.selectedAddress}),this.state.balance.gt(0)&&/*#__PURE__*/React.createElement(Allowance,{approve:function approve(amount){return _this2._setAllowance(amount);},tokenSymbol:this.state.tokenData.symbol})),/*#__PURE__*/React.createElement(\"div\",{className:\"row\"},/*#__PURE__*/React.createElement(\"div\",{className:\"col-4\"},this.state.balance.eq(0))))));}}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){this._stopPollingData();}},{key:\"_connectWallet\",value:function(){var _connectWallet2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _this3=this;var _yield$window$ethereu,_yield$window$ethereu2,selectedAddress;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return window.ethereum.enable();case 2:_yield$window$ethereu=_context.sent;_yield$window$ethereu2=_slicedToArray(_yield$window$ethereu,1);selectedAddress=_yield$window$ethereu2[0];if(this._checkNetwork()){_context.next=7;break;}return _context.abrupt(\"return\");case 7:this._initialize(selectedAddress);window.ethereum.on(\"accountsChanged\",function(_ref){var _ref2=_slicedToArray(_ref,1),newAddress=_ref2[0];_this3._stopPollingData();_this3._resetState();_this3._initialize(newAddress);return;});window.ethereum.on(\"networkChanged\",function(_ref3){var _ref4=_slicedToArray(_ref3,1),networkId=_ref4[0];_this3._stopPollingData();_this3._resetState();});case 10:case\"end\":return _context.stop();}}},_callee,this);}));function _connectWallet(){return _connectWallet2.apply(this,arguments);}return _connectWallet;}()},{key:\"_initialize\",value:function(){var _initialize2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(userAddress){var accounts,wallet,selectedName;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:accounts=ACC.accounts;wallet={};selectedName=undefined;_context2.next=5;return Object.keys(accounts).forEach(function(key){if(userAddress.toLowerCase()===key.toLowerCase()){selectedName=accounts[key];wallet[accounts[key]]=key;}else{wallet[accounts[key]]=key;}});case 5:_context2.next=7;return this.setState({accounts:wallet,selectedName:selectedName,selectedAddress:userAddress});case 7:if(!(selectedName===undefined)){_context2.next=10;break;}this.setState({accountError:'Please use one of the first 5 accounts provided by the mnemonic in .env '});return _context2.abrupt(\"return\",false);case 10:this._intializeEthers();this._getTokenData();this._startPollingData();return _context2.abrupt(\"return\",true);case 14:case\"end\":return _context2.stop();}}},_callee2,this);}));function _initialize(_x){return _initialize2.apply(this,arguments);}return _initialize;}()},{key:\"_intializeEthers\",value:function(){var _intializeEthers2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:this._provider=new ethers.providers.Web3Provider(window.ethereum);this._token=new ethers.Contract(ADR.contract,ABI.abi,this._provider.getSigner(0));case 2:case\"end\":return _context3.stop();}}},_callee3,this);}));function _intializeEthers(){return _intializeEthers2.apply(this,arguments);}return _intializeEthers;}()},{key:\"_startPollingData\",value:function _startPollingData(){var _this4=this;this._pollDataInterval=setInterval(function(){return _this4._updateAccount();},1000);this._updateAccount();}},{key:\"_stopPollingData\",value:function _stopPollingData(){clearInterval(this._pollDataInterval);this._pollDataInterval=undefined;}},{key:\"_getTokenData\",value:function(){var _getTokenData2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){var name,symbol,decimals,total,address;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return this._token.name();case 2:name=_context4.sent;_context4.next=5;return this._token.symbol();case 5:symbol=_context4.sent;_context4.next=8;return this._token.decimals();case 8:decimals=_context4.sent;_context4.next=11;return this._token.totalSupply();case 11:total=_context4.sent;_context4.next=14;return this._token.address;case 14:address=_context4.sent;this.setState({tokenData:{name:name,symbol:symbol,decimals:decimals,total:total,address:address}});case 16:case\"end\":return _context4.stop();}}},_callee4,this);}));function _getTokenData(){return _getTokenData2.apply(this,arguments);}return _getTokenData;}()},{key:\"_updateAccount\",value:function(){var _updateAccount2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){var balance,allowance,_balance,p1balance,p1allowance,p2balance,p2allowance;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:if(!(this.state.selectedAddress!==this.state.accounts.controller.toLowerCase())){_context5.next=11;break;}_context5.next=3;return this._token.balanceOf(this.state.selectedAddress);case 3:balance=_context5.sent;_context5.next=6;return this._token.allowance(this.state.selectedAddress,this.state.accounts.controller);case 6:allowance=_context5.sent;_context5.next=9;return this.setState({balance:balance,allowance:allowance});case 9:_context5.next=32;break;case 11:_context5.next=13;return this._token.balanceOf(this.state.selectedAddress);case 13:_balance=_context5.sent;_context5.next=16;return this.setState({balance:_balance});case 16:_context5.next=18;return this._token.balanceOf(this.state.accounts.lender);case 18:p1balance=_context5.sent;_context5.next=21;return this._token.allowance(this.state.accounts.lender,this.state.accounts.controller);case 21:p1allowance=_context5.sent;_context5.next=24;return this.setState({p1balance:p1balance,p1allowance:p1allowance});case 24:_context5.next=26;return this._token.balanceOf(this.state.accounts.borrower);case 26:p2balance=_context5.sent;_context5.next=29;return this._token.allowance(this.state.accounts.borrower,this.state.accounts.controller);case 29:p2allowance=_context5.sent;_context5.next=32;return this.setState({p2balance:p2balance,p2allowance:p2allowance});case 32:case\"end\":return _context5.stop();}}},_callee5,this);}));function _updateAccount(){return _updateAccount2.apply(this,arguments);}return _updateAccount;}()},{key:\"_transferTokens\",value:function(){var _transferTokens2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(to,amount){var tx,receipt;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_context6.prev=0;this._dismissTransactionError();_context6.next=4;return this._token.transfer(to,amount);case 4:tx=_context6.sent;this.setState({txBeingSent:tx.hash});_context6.next=8;return tx.wait();case 8:receipt=_context6.sent;if(!(receipt.status===0)){_context6.next=11;break;}throw new Error(\"Transaction failed\");case 11:_context6.next=13;return this._updateAccount();case 13:_context6.next=21;break;case 15:_context6.prev=15;_context6.t0=_context6[\"catch\"](0);if(!(_context6.t0.code===ERROR_CODE_TX_REJECTED_BY_USER)){_context6.next=19;break;}return _context6.abrupt(\"return\");case 19:console.error(_context6.t0);this.setState({transactionError:_context6.t0});case 21:_context6.prev=21;this.setState({txBeingSent:undefined});return _context6.finish(21);case 24:case\"end\":return _context6.stop();}}},_callee6,this,[[0,15,21,24]]);}));function _transferTokens(_x2,_x3){return _transferTokens2.apply(this,arguments);}return _transferTokens;}()},{key:\"_transferFromTokens\",value:function(){var _transferFromTokens2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(from,to,amount){var tx,receipt;return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:_context7.prev=0;this._dismissTransactionError();_context7.next=4;return this._token.transferFrom(from,to,amount);case 4:tx=_context7.sent;this.setState({txBeingSent:tx.hash});_context7.next=8;return tx.wait();case 8:receipt=_context7.sent;if(!(receipt.status===0)){_context7.next=11;break;}throw new Error(\"Transaction failed\");case 11:_context7.next=13;return this._updateAccount();case 13:_context7.next=20;break;case 15:_context7.prev=15;_context7.t0=_context7[\"catch\"](0);if(!(_context7.t0.code===ERROR_CODE_TX_REJECTED_BY_USER)){_context7.next=19;break;}return _context7.abrupt(\"return\");case 19:this.setState({transactionError:_context7.t0});case 20:_context7.prev=20;this.setState({txBeingSent:undefined});return _context7.finish(20);case 23:case\"end\":return _context7.stop();}}},_callee7,this,[[0,15,20,23]]);}));function _transferFromTokens(_x4,_x5,_x6){return _transferFromTokens2.apply(this,arguments);}return _transferFromTokens;}()},{key:\"_setAllowance\",value:function(){var _setAllowance2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee8(amount){var tx2,receipt;return _regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:_context8.prev=0;this._dismissTransactionError();_context8.next=4;return this._token.approve(this.state.accounts.controller,amount);case 4:tx2=_context8.sent;this.setState({txBeingSent:tx2.hash});_context8.next=8;return tx2.wait();case 8:receipt=_context8.sent;if(!(receipt.status===0)){_context8.next=11;break;}throw new Error(\"Transaction failed\");case 11:_context8.next=13;return this._updateAccount();case 13:_context8.next=21;break;case 15:_context8.prev=15;_context8.t0=_context8[\"catch\"](0);if(!(_context8.t0.code===ERROR_CODE_TX_REJECTED_BY_USER)){_context8.next=19;break;}return _context8.abrupt(\"return\");case 19:console.error(_context8.t0);this.setState({transactionError:_context8.t0});case 21:_context8.prev=21;this.setState({txBeingSent:undefined});return _context8.finish(21);case 24:case\"end\":return _context8.stop();}}},_callee8,this,[[0,15,21,24]]);}));function _setAllowance(_x7){return _setAllowance2.apply(this,arguments);}return _setAllowance;}()},{key:\"_dismissTransactionError\",value:function _dismissTransactionError(){this.setState({transactionError:undefined});}},{key:\"_dismissNetworkError\",value:function _dismissNetworkError(){this.setState({networkError:undefined});}},{key:\"_dismissAccountError\",value:function _dismissAccountError(){this.setState({accountError:undefined});return;}},{key:\"_getRpcErrorMessage\",value:function _getRpcErrorMessage(error){var err=error;return err.error.message;}},{key:\"_resetState\",value:function _resetState(){this.setState(this.initialState);}},{key:\"_checkNetwork\",value:function _checkNetwork(){var network=ADR.network;if(window.ethereum.networkVersion!==ADR.networkId){this.setState({networkError:\"Please connect Metamask to network: \".concat(network)});return false;}return true;}},{key:\"_checkAccounts\",value:function _checkAccounts(){if(this.state.accounts===undefined||this.state.selectedAddress!==this.state.accounts.controller.toLowerCase()&&this.state.selectedAddress!==this.state.accounts.lender.toLowerCase()&&this.state.selectedAddress!==this.state.accounts.borrower.toLowerCase()){this.setState({accountError:'Please use one of the first accounts provided by the mnemonic in .env '});return false;}return true;}}]);return Dapp;}(React.Component);","map":{"version":3,"sources":["/Users/rudy/Code/HLF2_DEV/network/eth-allowance-explorer/src/components/Dapp.js"],"names":["React","ethers","ABI","ADR","ACC","NoWalletDetected","ConnectWallet","Loading","Transfer","TransferFrom","Allowance","TransactionErrorMessage","WaitingForTransactionMessage","NoTokensMessage","Contract","ERROR_CODE_TX_REJECTED_BY_USER","Dapp","props","initialState","tokenData","undefined","total","selectedAddress","selectedName","balance","allowance","txBeingSent","transactionError","networkError","accountError","state","window","ethereum","_connectWallet","_dismissNetworkError","accounts","controller","toLowerCase","lender","borrower","_dismissAccountError","console","log","Math","round","p1balance","decimals","toFixed","toString","p1allowance","p2balance","p2allowance","_getRpcErrorMessage","_dismissTransactionError","eq","gt","to","amount","_transferTokens","symbol","from","_transferFromTokens","_setAllowance","_stopPollingData","enable","_checkNetwork","_initialize","on","newAddress","_resetState","networkId","userAddress","wallet","Object","keys","forEach","key","setState","_intializeEthers","_getTokenData","_startPollingData","_provider","providers","Web3Provider","_token","contract","abi","getSigner","_pollDataInterval","setInterval","_updateAccount","clearInterval","name","totalSupply","address","balanceOf","transfer","tx","hash","wait","receipt","status","Error","code","error","transferFrom","approve","tx2","err","message","network","networkVersion","Component"],"mappings":"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","sourcesContent":["import React from \"react\";\n\n// We'll use ethers to interact with the Ethereum network and our contract\nimport { ethers } from \"ethers\";\n\n// We import the contract's artifacts and address here, as we are going to be\n// using them with ethers\nimport ABI from \"../contract/abi.json\";\nimport ADR from \"../contract/adr.json\";\nimport ACC from \"../contract/acc.json\";\n\n// All the logic of this dapp is contained in the Dapp component.\n// These other components are just presentational ones: they don't have any\n// logic. They just render HTML.\nimport { NoWalletDetected } from \"./NoWalletDetected\";\nimport { ConnectWallet } from \"./ConnectWallet\";\nimport { Loading } from \"./Loading\";\nimport { Transfer } from \"./Transfer\";\nimport { TransferFrom } from \"./TransferFrom\";\nimport { Allowance } from \"./Allowance\";\nimport { TransactionErrorMessage } from \"./TransactionErrorMessage\";\nimport { WaitingForTransactionMessage } from \"./WaitingForTransactionMessage\";\nimport { NoTokensMessage } from \"./NoTokensMessage\";\nimport { Contract } from \"./Contract\";\n\n\nconst ERROR_CODE_TX_REJECTED_BY_USER = 4001;\n\n\nexport class Dapp extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.initialState = {\n      tokenData: undefined,\n      total: undefined,\n      selectedAddress: undefined,\n      selectedName: undefined,\n      balance: undefined,\n      allowance: undefined,\n      txBeingSent: undefined,\n      transactionError: undefined,\n      networkError: undefined,\n      accountError: undefined,\n    };\n\n    this.state = this.initialState;\n\n  }\n\n\n\n  render() {\n\n    if (window.ethereum === undefined) {\n      return <NoWalletDetected />;\n    }\n\n\n    if (this.state.networkError) {\n      return (\n        <ConnectWallet\n          connectWallet={() => this._connectWallet()}\n          networkError={this.state.networkError}\n          dismiss={() => this._dismissNetworkError()}\n        />\n      );\n    }\n\n    if (this.state.accountError ||\n      this.state.accounts === undefined ||\n      ((this.state.selectedAddress !== this.state.accounts.controller.toLowerCase()) && (this.state.selectedAddress !== this.state.accounts.lender.toLowerCase()) && (this.state.selectedAddress !== this.state.accounts.borrower.toLowerCase()))) {\n      return (\n        <ConnectWallet\n          connectWallet={() => this._connectWallet()}\n          networkError={this.state.accountError}\n          dismiss={() => this._dismissAccountError()}\n        />\n      );\n    }\n\n    if (!this.state.tokenData || !this.state.accounts) {\n      return <Loading />;\n    }\n    console.log(this.state)\n    if (this.state.selectedName === \"controller\") {\n      return (\n        <div className=\"\">\n          <div className=\"row\">\n            <Contract tokenData={this.state.tokenData} />\n          </div>\n\n\n          <div className=\"container\">\n\n          <h2>Controller's Account</h2>\n\n            <div className=\"row\">\n              <div className=\"col-6 p-3 card\">\n                <h2>Lender</h2>\n                <p>\n                  Balance:  <b>$ {(Math.round(this.state.p1balance * this.state.tokenData.decimals ** 10) / (this.state.tokenData.decimals ** 10)).toFixed(this.state.tokenData.decimals).toString()}</b>\n                </p>\n                <p>\n                  Allowed:  <b>$ {(Math.round(this.state.p1allowance * this.state.tokenData.decimals ** 10) / (this.state.tokenData.decimals ** 10)).toFixed(this.state.tokenData.decimals).toString()}</b>\n                </p>\n              </div>\n              <div className=\"col-6 p-3 card\">\n                <h2>Borrower</h2>\n                <p>\n                  Balance:  <b>$ {(Math.round(this.state.p2balance * this.state.tokenData.decimals ** 10) / (this.state.tokenData.decimals ** 10)).toFixed(this.state.tokenData.decimals).toString()}</b>\n                </p>\n                <p>\n                  Allowed:  <b>$ {(Math.round(this.state.p2allowance * this.state.tokenData.decimals ** 10) / (this.state.tokenData.decimals ** 10)).toFixed(this.state.tokenData.decimals).toString()}</b>\n                </p>\n              </div>\n            </div>\n            <div>\n              {this.state.txBeingSent && (<WaitingForTransactionMessage txHash={this.state.txBeingSent} />)}\n              {this.state.transactionError && (\n                <TransactionErrorMessage\n                  message={this._getRpcErrorMessage(this.state.transactionError)}\n                  dismiss={() => this._dismissTransactionError()}\n                />)}\n\n            </div>\n\n\n          <div className=\"row mt-10\">\n            <div className=\"col-6 card\">\n              {this.state.balance.eq(0) && (\n                <NoTokensMessage selectedAddress={this.state.selectedAddress} />\n              )}\n              {this.state.balance.gt(0) && (\n                <Transfer\n                  transferTokens={(to, amount) =>\n                    this._transferTokens(to, amount)\n                  }\n                  tokenSymbol={this.state.tokenData.symbol}\n                  accounts={this.state.accounts}\n                />\n              )}\n            </div>\n            <div className=\"col-6 card\">\n              {this.state.balance.eq(0) && (\n                <NoTokensMessage selectedAddress={this.state.selectedAddress} />\n              )}\n              {this.state.balance.gt(0) && (\n                <TransferFrom\n                transferFromTokens={(from, to, amount) =>\n                    this._transferFromTokens(from, to, amount)\n                  }\n                  tokenSymbol={this.state.tokenData.symbol}\n                  accounts={this.state.accounts}\n                />\n              )}\n            </div>\n          </div>\n          </div>\n        </div>\n      );\n\n\n    } else if (this.state.selectedName === \"lender\" || this.state.selectedName === \"borrower\") {\n      return (\n        <div className=\"\">\n          <div className=\"row\">\n            <Contract tokenData={this.state.tokenData} />\n          </div>\n\n\n          <div className=\"container\">\n            <div className=\"row\">\n              <h1>{this.state.selectedName}</h1>\n              </div>\n              <div className=\"row card\">\n                <div className=\"col-3\">\n                  <p>Balance:</p>\n                  <p>Approved amount:</p>\n                </div>\n                <div className=\"col-3\">\n                  <p><b>$ {(Math.round(this.state.balance * this.state.tokenData.decimals ** 10) / (this.state.tokenData.decimals ** 10)).toFixed(this.state.tokenData.decimals).toString()}</b></p>\n                  <p><b>$ {(Math.round(this.state.allowance * this.state.tokenData.decimals ** 10) / (this.state.tokenData.decimals ** 10)).toFixed(this.state.tokenData.decimals).toString()}</b></p>\n                </div>\n              </div>\n\n              <div>\n\n                {this.state.txBeingSent && (<WaitingForTransactionMessage txHash={this.state.txBeingSent} />)}\n\n                {this.state.transactionError && (\n                  <TransactionErrorMessage\n                    message={this._getRpcErrorMessage(this.state.transactionError)}\n                    dismiss={() => this._dismissTransactionError()}\n                  />)}\n              </div>\n            <div className=\"row card\">\n              <div className=\"col-4\">\n\n                {this.state.balance.eq(0) && (\n                  <NoTokensMessage selectedAddress={this.state.selectedAddress} />\n                )}\n\n                {this.state.balance.gt(0) && (\n                  <Allowance\n                    approve={(amount) =>\n                      this._setAllowance(amount)\n                    }\n                    tokenSymbol={this.state.tokenData.symbol}\n                  />\n                )}\n              </div>\n              <div className=\"row\">\n                <div className=\"col-4\">\n\n                  {this.state.balance.eq(0)}\n\n\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      );\n\n    }\n  }\n\n\n  componentWillUnmount() {\n\n    this._stopPollingData();\n  }\n\n  async _connectWallet() {\n\n    const [selectedAddress] = await window.ethereum.enable();\n\n    if (!this._checkNetwork()) {\n      return;\n    }\n\n    this._initialize(selectedAddress)\n\n    window.ethereum.on(\"accountsChanged\", ([newAddress]) => {\n      this._stopPollingData();\n      this._resetState();\n\n      this._initialize(newAddress);\n\n      return\n    });\n\n    window.ethereum.on(\"networkChanged\", ([networkId]) => {\n      this._stopPollingData();\n      this._resetState();\n    });\n  }\n\n  async _initialize(userAddress) {\n\n    let accounts = ACC.accounts\n    let wallet = {}\n    let selectedName = undefined\n    await Object.keys(accounts).forEach(key => {\n      if (userAddress.toLowerCase() === key.toLowerCase()) {\n        selectedName = accounts[key]\n        wallet[accounts[key]] = key\n      } else {\n        wallet[accounts[key]] = key\n      }\n    });\n\n    await this.setState({\n      accounts: wallet,\n      selectedName: selectedName,\n      selectedAddress: userAddress,\n    });\n\n    if (selectedName === undefined) {\n      this.setState({\n        accountError: 'Please use one of the first 5 accounts provided by the mnemonic in .env '\n      });\n      return false\n    }\n\n    this._intializeEthers();\n    this._getTokenData();\n    this._startPollingData();\n\n    return true\n  }\n\n  async _intializeEthers() {\n    this._provider = new ethers.providers.Web3Provider(window.ethereum);\n\n    this._token = new ethers.Contract(\n      ADR.contract,\n      ABI.abi,\n      this._provider.getSigner(0)\n    );\n\n\n  }\n\n  _startPollingData() {\n    this._pollDataInterval = setInterval(() => this._updateAccount(), 1000);\n\n    this._updateAccount();\n\n  }\n\n  _stopPollingData() {\n    clearInterval(this._pollDataInterval);\n    this._pollDataInterval = undefined;\n  }\n\n  async _getTokenData() {\n    const name = await this._token.name();\n    const symbol = await this._token.symbol();\n    const decimals = await this._token.decimals();\n    const total = await this._token.totalSupply();\n    const address = await this._token.address;\n\n    this.setState({ tokenData: { name, symbol, decimals, total, address } });\n  }\n\n  async _updateAccount() {\n\n    if (this.state.selectedAddress !== this.state.accounts.controller.toLowerCase()) {\n      let balance = await this._token.balanceOf(this.state.selectedAddress);\n      let allowance = await this._token.allowance(this.state.selectedAddress, this.state.accounts.controller);\n\n      await this.setState({ balance, allowance });\n\n    } else {\n\n      let balance = await this._token.balanceOf(this.state.selectedAddress);\n\n      await this.setState({ balance });\n\n      let p1balance = await this._token.balanceOf(this.state.accounts.lender);\n      let p1allowance = await this._token.allowance(this.state.accounts.lender, this.state.accounts.controller);\n\n      await this.setState({ p1balance, p1allowance });\n\n      let p2balance = await this._token.balanceOf(this.state.accounts.borrower);\n      let p2allowance = await this._token.allowance(this.state.accounts.borrower, this.state.accounts.controller);\n\n      await this.setState({ p2balance, p2allowance });\n    }\n\n\n\n\n  }\n\n  async _transferTokens(to, amount) {\n    try {\n\n      this._dismissTransactionError();\n\n      const tx = await this._token.transfer(to, amount);\n      this.setState({ txBeingSent: tx.hash });\n\n      const receipt = await tx.wait();\n\n      if (receipt.status === 0) {\n\n        throw new Error(\"Transaction failed\");\n      }\n\n      await this._updateAccount();\n    } catch (error) {\n      // REJECTED TX BY USER\n      if (error.code === ERROR_CODE_TX_REJECTED_BY_USER) {\n        return;\n      }\n\n      console.error(error);\n      this.setState({ transactionError: error });\n    } finally {\n\n      this.setState({ txBeingSent: undefined });\n    }\n  }\n\n  async _transferFromTokens(from, to, amount) {\n    try {\n\n      this._dismissTransactionError();\n\n\n      const tx = await this._token.transferFrom(from, to, amount);\n      this.setState({ txBeingSent: tx.hash });\n\n      const receipt = await tx.wait();\n\n      if (receipt.status === 0) {\n\n        throw new Error(\"Transaction failed\");\n      }\n\n      await this._updateAccount();\n    } catch (error) {\n      // REJECTED TX BY USER\n      if (error.code === ERROR_CODE_TX_REJECTED_BY_USER) {\n        return;\n      }\n\n      this.setState({ transactionError: error });\n    } finally {\n\n      this.setState({ txBeingSent: undefined });\n    }\n  }\n\n  async _setAllowance(amount) {\n\n    try {\n\n      this._dismissTransactionError();\n\n      const tx2 = await this._token.approve(this.state.accounts.controller, amount);\n      this.setState({ txBeingSent: tx2.hash });\n\n      const receipt = await tx2.wait();\n\n      if (receipt.status === 0) {\n        throw new Error(\"Transaction failed\");\n      }\n\n      await this._updateAccount();\n    } catch (error) {\n      // REJECTED TX BY USER\n      if (error.code === ERROR_CODE_TX_REJECTED_BY_USER) {\n        return;\n      }\n\n      console.error(error);\n      this.setState({ transactionError: error });\n    } finally {\n\n      this.setState({ txBeingSent: undefined });\n    }\n  }\n\n  _dismissTransactionError() {\n    this.setState({ transactionError: undefined });\n  }\n\n  _dismissNetworkError() {\n    this.setState({ networkError: undefined });\n  }\n\n  _dismissAccountError() {\n    this.setState({ accountError: undefined });\n    return;\n  }\n\n  _getRpcErrorMessage(error) {\n    let err = error\n\n    return err.error.message;\n  }\n\n  _resetState() {\n    this.setState(this.initialState);\n  }\n\n  _checkNetwork() {\n    let network = ADR.network\n\n    if (window.ethereum.networkVersion !== ADR.networkId) {\n      this.setState({\n        networkError: `Please connect Metamask to network: ${network}`\n      });\n\n      return false;\n    }\n    return true\n  }\n\n  _checkAccounts() {\n\n    if (this.state.accounts === undefined ||\n      ((this.state.selectedAddress !== this.state.accounts.controller.toLowerCase()) && (this.state.selectedAddress !== this.state.accounts.lender.toLowerCase()) && (this.state.selectedAddress !== this.state.accounts.borrower.toLowerCase()))) {\n      this.setState({\n        accountError: 'Please use one of the first accounts provided by the mnemonic in .env '\n      });\n      return false\n    }\n\n    return true;\n  }\n}\n"]},"metadata":{},"sourceType":"module"}